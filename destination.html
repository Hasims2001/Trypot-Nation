<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destinations</title>
    <link rel="stylesheet" href="./style/destination.css">

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"
        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
        <script>
        $(function () {
            $("#header").load("page_hader.html");
            $("#footer").load("pagefooter.html");

        });
    </script>


    <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
    }

    body {
        background-color: #f4f4f4;
    }

    #header {
        position: absolute;
        top: 0;
        left: 0;
        padding: 5px 100px;
        display: flex;
        align-items: center;
    }

    #destinations {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        padding: 8%;
        margin-top: 20px;
        padding-bottom: 20px;
    }

    .destcard {
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        max-width: 600px;
        margin-bottom: 30px;
        border: 1px solid #ddd;

    }

    .destcard .dest-card-title {
        padding: 20px;
        font-size: 25px;
        font-weight: bold;
        background-color: #417c71;
        color: #fff;
        text-align: center;
    }

    .card .dest-carousel {
        position: relative;
    }

    .dest-carousel-images {
        display: flex;
        overflow-x: hidden;
        height: 300px;
    }

    .dest-carousel-images img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .dest-indicators {
        display: none;
    }



    .read-more-btn { 
        
        display: block;
        margin: 20px auto;
        padding: 10px 20px;
        background-color: #359381;
        border: none;
        border-radius: 5px;
        color: #fff;
        font-size: 20px;
        cursor: pointer;
        width: 30%;
    }

    .read-more-btn:hover {
        background-color: lightseagreen;
    }


    @media only screen and (max-width: 400px) {
        #destinations {
            grid-template-columns: repeat(1, 1fr);
        }
    }
    
    </style>

</head>

<body>
    

    <!-- navigation bar starts here -->
        
        <header id="header"></header>
    <!-- navigation bar ends here -->

    <!-- main section starts here -->
    <section id="destinations">
        <!-- data will be appended here -->
    </section>
    <!-- main section ends here -->



    <footer id="footer"></footer>

</body>

<script>
    const destURL = "https://trypot-nation.onrender.com/packages";

    // Append div to main section
    let mainSection = document.getElementById("destinations");

    //Destination Data
    let destData = [];

    fetchData();

    function fetchData(){
        fetch(destURL)
        .then(function(res){
            return res.json();
        })
        .then(function(data){
            appendData(data);
            destData = data;
        })
        .catch(function(error){
            console.log(error);
        })
    }



    function appendData(data){
        mainSection.innerHTML = "";
        let states = {};
        data.forEach(item => {
            if (!states[item.destination]) {
                states[item.destination] = [];
            }
            states[item.destination].push(item);
        });
        for (let state in states) {
            let cardsList = document.createElement("div");
            cardsList.className = "dest-card-list";
            mainSection.append(cardsList);
            let card = stateCardCreate(state, states[state]);
            cardsList.append(card);
        }
    }

    function stateCardCreate(state, items, description){
        let card = document.createElement("div");
        card.className = "destcard";
        let h3 = document.createElement("h3");

        h3.className = "dest-card-title";
        h3.textContent = state;
        card.append(h3);

        // let p = document.createElement("p");
        // p.textContent = items[0].description[0];
        // card.append(p);

        let carouselDiv = document.createElement("div");
        carouselDiv.className = "dest-carousel";
        let indicatorsDiv = document.createElement("div");
        indicatorsDiv.className = "dest-indicators";
        let imagesDiv = document.createElement("div");
        imagesDiv.className = "dest-carousel-images";
        let index = 0;
        items.forEach(item => {
            let indicator = document.createElement("button");
            indicator.className = "dest-indicator";
            if (index == 0) {
            indicator.classList.add("active");
            }
            indicatorsDiv.append(indicator);
            let img = document.createElement("img");
            img.src = item.image[0];
            img.setAttribute("alt","state");
            imagesDiv.append(img);
            index++;
        });

        carouselDiv.append(indicatorsDiv, imagesDiv);
        card.append(carouselDiv);
        let readMoreBtn = document.createElement("button");
        readMoreBtn.className = "read-more-btn";
        readMoreBtn.textContent = "Read More";

        readMoreBtn.addEventListener("click", function(){
            let state = h3.textContent;
            window.location.href = "./destDetails.html?state=" + state;
        });
        card.append(readMoreBtn);

        // Carousel functionality
        let images = imagesDiv.getElementsByTagName('img');
        let indicators = indicatorsDiv.getElementsByTagName('button');
        let currentIndex = 0;
        let timeoutId;
        
        function showImage(index) {
            if (timeoutId) {
            clearTimeout(timeoutId);
            }
            for (let i = 0; i < images.length; i++) {
            images[i].style.display = "none";
            }
            images[index].style.display = "block";
            for (let i = 0; i < indicators.length; i++) {
            indicators[i].classList.remove("active");
            }
            indicators[index].classList.add("active");
            timeoutId = setTimeout(() => {
            showImage((index + 1) % images.length);
            }, 5000);
        }

        showImage(currentIndex);

        return card;
    }

</script>

</html>
